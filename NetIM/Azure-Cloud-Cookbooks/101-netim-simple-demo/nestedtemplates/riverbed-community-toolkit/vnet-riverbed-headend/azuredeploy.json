{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.201115",
    "parameters": {
      "location": {
        "type": "string",
        "defaultValue": "[resourceGroup().location]",
        "metadata": {
          "description": "The location in which the resources should be deployed."
        }
      },
      "virtualNetworkName": {
        "type": "string",
        "metadata": {
          "Description": "The name of the Virtual Network to Create"
        },
        "defaultValue" : "riverbed-community-headend"
      },
      "virtualNetworkAddressRange": {
        "type": "string",
        "metadata": {
          "Description": "The address range of the new VNET in CIDR format"
        },
        "defaultValue": "10.100.0.0/16"
      },
      "subnetName_Management": {
        "type": "string",
        "metadata": {
          "Description": "The name of the subnet for Management"
        },
        "defaultValue": "Management"
      },
      "subnetRange_Management": {
        "type": "string",
        "metadata": {
          "Description": "The address range of the subnet created in the new VNET for Management"
        },
        "defaultValue": "10.100.1.0/24"
      },
      "subnetName_Control": {
        "type": "string",
        "metadata": {
          "Description": "The name of the subnet for Control"
        },
        "defaultValue": "Control"
      },
      "subnetRange_Control": {
        "type": "string",
        "metadata": {
          "Description": "The address range of the subnet created in the new VNET for Control"
        },
        "defaultValue": "10.100.2.0/24"
      },
      "subnetName_Analytics": {
        "type": "string",
        "metadata": {
          "Description": "The name of the subnet for Analytics"
        },
        "defaultValue": "Analytics"
      },
      "subnetRange_Analytics": {
        "type": "string",
        "metadata": {
          "Description": "The address range of the subnet created in the new VNET for Analytics"
        },
        "defaultValue": "10.100.3.0/24"
      },
      "subnetName_Performance": {
        "type": "string",
        "metadata": {
          "Description": "The name of the subnet for Performance"
        },
        "defaultValue": "Performance"
      },
      "subnetRange_Performance": {
        "type": "string",
        "metadata": {
          "Description": "The address range of the subnet created in the new VNET for Performance"
        },
        "defaultValue": "10.100.4.0/24"
      },
      "subnetName_Monitoring": {
        "type": "string",
        "metadata": {
          "Description": "The name of the subnet for Monitoring"
        },
        "defaultValue": "Monitoring"
      },
      "subnetRange_Monitoring": {
        "type": "string",
        "metadata": {
          "Description": "The address range of the subnet created in the new VNET for Monitoring"
        },
        "defaultValue": "10.100.5.0/24"
      },
      "subnetName_Workloads": {
        "type": "string",
        "metadata": {
          "Description": "The name of the subnet for Workloads"
        },
        "defaultValue": "Workloads"
      },
      "subnetRange_Workloads": {
        "type": "string",
        "metadata": {
          "Description": "The address range of the subnet created in the new VNET for Workloads"
        },
        "defaultValue": "10.100.50.0/24"
      },
      "subnetName_Kubernetes": {
        "type": "string",
        "metadata": {
          "Description": "The name of the subnet for Kubernetes"
        },
        "defaultValue": "Kubernetes"
      },
      "subnetRange_Kubernetes": {
        "type": "string",
        "metadata": {
          "Description": "The address range of the subnet created in the new VNET for Kubernetes"
        },
        "defaultValue": "10.100.80.0/24"
      },
      "subnetName_Accelerator": {
        "type": "string",
        "metadata": {
          "Description": "The name of the subnet for Accelerator"
        },
        "defaultValue": "Accelerator"
      },
      "subnetRange_Accelerator": {
        "type": "string",
        "metadata": {
          "Description": "The address range of the subnet created in the new VNET for Accelerator"
        },
        "defaultValue": "10.100.82.0/24"
      },
      "subnetRange_Bastion": {
        "type": "string",
        "metadata": {
          "Description": "The address range of the subnet created in the new VNET for Bastion"
        },
        "defaultValue": "10.100.253.0/24"
      }
    },
    "resources": [
      {
        "name": "[parameters('virtualNetworkName')]",
        "type": "Microsoft.Network/virtualNetworks",
        "location": "[parameters('location')]",
        "apiVersion": "2020-05-01",
        "properties": {
          "addressSpace": {
            "addressPrefixes": [
              "[parameters('virtualNetworkAddressRange')]"
            ]
          },
          "subnets": [
            {
              "name": "[parameters('subnetName_Management')]",
              "properties": {
                "addressPrefix": "[parameters('subnetRange_Management')]"
              }
            },
            {
              "name": "[parameters('subnetName_Control')]",
              "properties": {
                "addressPrefix": "[parameters('subnetRange_Control')]"
              }
            },
            {
              "name": "[parameters('subnetName_Analytics')]",
              "properties": {
                "addressPrefix": "[parameters('subnetRange_Analytics')]"
              }
            },
            {
              "name": "[parameters('subnetName_Performance')]",
              "properties": {
                "addressPrefix": "[parameters('subnetRange_Performance')]"
              }
            },
            {
              "name": "[parameters('subnetName_Monitoring')]",
              "properties": {
                "addressPrefix": "[parameters('subnetRange_Monitoring')]"
              }
            },
            {
              "name": "[parameters('subnetName_Workloads')]",
              "properties": {
                "addressPrefix": "[parameters('subnetRange_Workloads')]"
              }
            },
            {
              "name": "[parameters('subnetName_Kubernetes')]",
              "properties": {
                "addressPrefix": "[parameters('subnetRange_Kubernetes')]"
              }
            },
            {
              "name": "[parameters('subnetName_Accelerator')]",
              "properties": {
                "addressPrefix": "[parameters('subnetRange_Accelerator')]"
              }
            },
            {
              "name": "AzureBastionSubnet",
              "properties": {
                "addressPrefix": "[parameters('subnetRange_Bastion')]"
              }
            }
          ]
        }
      }
    ],
    "outputs": {
      "virtualNetworkId" : {
        "type" : "string",
        "value": "[resourceId('Microsoft.Network/virtualNetworks',parameters('virtualNetworkName'))]"
      },
      "subnetName_Monitoring" : {
        "type" : "string",
        "value": "[parameters('subnetName_Monitoring')]"
      },
      "subnetRef_Monitoring" : {
        "type" : "string",
        "value": "[resourceId('Microsoft.Network/virtualNetworks/subnets',parameters('virtualNetworkName'),parameters('subnetName_Monitoring'))]"
      },
      "subnetRef_Bastion" : {
        "type" : "string",
        "value": "[resourceId('Microsoft.Network/virtualNetworks/subnets',parameters('virtualNetworkName'),'BastionSubnet')]"
      }
    }
  }